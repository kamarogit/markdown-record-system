# プロジェクト仕様書

## 1. プロジェクト概要

- **目的：**
  - ユーザー自身が自由に記録テンプレート（フォームUI）と対応するDBスキーマを設計・作成でき、 記録→Markdown保存→DB登録→AI活用（要約・検索・出力）までを一貫して楽に構築・運用できる「業務記録プラットフォーム」の開発
  - 例）服薬指導記録などの業務記録をMarkdown形式＋DBで構造化し、AI活用まで一気通貫で実現するシステムの開発
- **ターゲットユーザー：**
  - 医療従事者、教育・法務・行政など記録業務のある職種
- **想定する価値：**
  - 記録の効率化、再利用性UP、AIによる業務支援　など

---

## 2. 機能一覧

- 記録フォームUI
- Markdown＋YAML frontmatterでローカルファイルとして記録データを保存
- DB（例：SQLite）には、記録のメタデータ（例：ID, 日付, 患者名など）と、Markdownファイルの保存パス・リンクなどを保持
  - DBから記録を検索・一覧表示する際、Markdownファイルと紐付けて呼び出しや編集が可能
  - 外部UIやAIからも記録データに直接アクセスしやすい設計
- AI要約・タグ付け（**現時点ではOpenAI APIに決め打ちで実装**。将来的な他プロバイダ/ローカルLLM拡張も設計を意識）
  - AI要約やタグはDBのメタデータにも保持し、検索や分析にも活用
  - **AI未使用でも全機能が動作するよう設計**
- 記録データの検索・集計（DBのメタ情報で高速に検索、Markdown本文も全文検索可能に設計）
- 記録テンプレートの編集機能（将来的に）
- 出力形式変換（HTML/PDF等、Markdownファイルから自動変換）
- 外部APIや他システム連携も見据えた設計（例：外部UIから記録参照、AIエンジンにデータ送信）

---

## 3. 画面・UIイメージ

### フォーム画面

- **画面目的**
  - 業務記録を新規作成するための入力フォーム画面。

- **主な入力項目**
  - 患者名（テキスト入力）
  - 患者ID（数値またはテキスト）
  - 診察日（カレンダー選択）
  - 処方内容（テキストエリア）
  - S（主観的情報：テキストエリア）
  - O（客観的情報：テキストエリア）
  - A（評価・考察：テキストエリア）
  - P（計画・指導内容：テキストエリア）

- **操作フロー**
  1. 画面上部に患者情報・日付などを入力
  2. 処方内容を入力
  3. S/O/A/P 各欄を記入
  4. [保存]ボタンで登録

- **レイアウト擬似表記**
  ```
  ┌─────────────────────────────┐
  │ 患者名 [＿＿＿＿＿] 患者ID [＿＿＿＿] 診察日 [＿＿＿]
  ├─────────────────────────────┤
  │ 処方内容 [＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿]
  ├─────────────────────────────┤
  │ S [＿＿＿＿＿＿＿＿＿＿＿＿]
  │ O [＿＿＿＿＿＿＿＿＿＿＿＿]
  │ A [＿＿＿＿＿＿＿＿＿＿＿＿]
  │ P [＿＿＿＿＿＿＿＿＿＿＿＿]
  ├─────────────────────────────┤
  │ [保存]                                    │
  └─────────────────────────────┘
  ```

---

### 記録一覧画面

- **画面目的**
  - 登録済みの記録を一覧表示。検索・ソートも可能。

- **主な表示項目**
  - 日付
  - 患者名
  - 記録概要（要約）

- **主な操作**
  - 検索窓（患者名・日付などでフィルタ）
  - 各記録の「閲覧」ボタン

---

### 記録閲覧／編集画面

- **画面目的**
  - 選択した記録の詳細を閲覧・必要に応じて編集

- **主な表示項目**
  - 入力済み内容（フォームと同じ構成）
  - [編集] [保存]ボタン

---

## 4. データ構造

- Markdownファイルのサンプル
- YAML frontmatterの構成
- DBスキーマ案
  - 記録ID（自動採番 or UUID）
  - 入力日時・更新日時
  - 作成者（ユーザー名・ID）
  - 記録種別（テンプレ型名）
  - 患者ID
  - 関連ファイルパス
  - AI要約（AIまたは手入力）
  - AIタグ（AIまたは手入力）
  - バージョン情報
  - 外部参照ID

---

## 5. システム構成・技術スタック

- フロントエンド：Streamlit
- バックエンド：FastAPI（Python）
- データベース：SQLite（MVP）、PostgreSQL（拡張時）
- AI連携：OpenAI API（現時点で決め打ち）。将来拡張の設計余地あり。
- デプロイ：Docker＋**自宅サーバー**（VPS/クラウド等も将来拡張）

---

## 6. AI活用の範囲

- 記録内容の要約（AIによる自動生成はOpenAI APIにて実装。手入力要約も可能）
- 自動タグ付け（AIオプション）
- 自然文検索（AIオプション）
- レポート・KPI自動生成（今後AIで追加予定、AI不使用時は手動運用でカバー）

---

## 7. 開発フェーズ・優先順位

1. 最小構成MVP（服薬指導記録→Markdown保存）
2. DB保存・検索機能
3. AI要約・タグ付け機能追加
4. テンプレート編集・他分野対応
5. 出力・可視化機能追加

---

## 8. 備考・今後の課題

- セキュリティ・個人情報保護への配慮
- SaaS化・マルチテナント対応
- UI/UX改善案
- **AI機能は今はOpenAI API決め打ちで実装。将来的なローカルLLM等への拡張も構造上対応可能な設計を意識する。**
- **AIサービス障害や利用不可時も、記録保存・閲覧等の基本機能はAI非依存で安定して動作**

---

## 9. 将来的なゴール・展望

- ユーザー自身がGUI（または設定ファイル）で記録テンプレート（フォーム項目）を作成・編集できる仕組みを実現する。
- テンプレートに連動してDBスキーマ（テーブル構造）も自動生成・管理される。
- 記録内容の入力、DB保存、Markdown生成、AI連携（要約・タグ付け・検索等）までが一貫して実装・運用できる。
- Googleフォームのようなノーコード／ローコードのフォーム作成体験を提供し、どんな分野・用途にも柔軟に適用できる汎用的な記録プラットフォームを目指す。
- テンプレートや記録データの再利用・共有・公開の仕組みも検討する。

---

## 10. APIインターフェース（将来的拡張）

### API設計（案）

- GET `/api/records`
  - 概要: 記録の一覧を返す
  - レスポンス: JSON配列

- GET `/api/record/{record_id}`
  - 概要: 特定記録を取得
  - パラメータ: record_id
  - レスポンス: JSONオブジェクト

- POST `/api/record`
  - 概要: 新規記録の追加
  - リクエスト: JSON（記録項目＋メタデータ）

- PUT `/api/record/{record_id}`
  - 概要: 既存記録の更新
  - リクエスト: JSON

- DELETE `/api/record/{record_id}`
  - 概要: 記録の削除

---

> ※APIは将来的な拡張機能として設計。実装優先度は低め。必要に応じて認証や外部連携などの機能を追加予定。
